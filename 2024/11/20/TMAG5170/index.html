<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<!--Description-->



    <meta name="description" content="TMAG5170 is a 3-axis precision Hall effect sensor designed by Texas Instruments. On top of the Hall effect sensor, there is a temperature sensor and angle calculator intergrated in the IC. The functions of the IC can be interfaced with SPI. There are two variant of this IC, A1 and A2, the two variants differ in measuring range."/>


<!--Author-->

    <meta name="author" content="Chen, Liang-Yu"/>


<!--Open Graph Title-->

    <meta property="og:title" content="TMAG5170 3D Hall-effect sensor"/>


<!--Open Graph Description-->

    <meta property="og:description" content="TMAG5170 is a 3-axis precision Hall effect sensor designed by Texas Instruments. On top of the Hall effect sensor, there is a temperature sensor and angle calculator intergrated in the IC. The functions of the IC can be interfaced with SPI. There are two variant of this IC, A1 and A2, the two variants differ in measuring range."/>


<!--Open Graph Site Name-->
    <meta property="og:site_name" content="light655"/>

<!--Type page-->

    <meta property="og:type" content="article"/>


<!--Page Cover-->


    <meta property="og:image" content="http://example.com/img/home-bg-new.webp"/>


<meta name="twitter:card" content="summary_large_image"/>




    <meta name="twitter:image" content="http://example.com/img/home-bg-new.webp"/>


<!-- Title -->

<title>TMAG5170 3D Hall-effect sensor | light655</title>

<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css">

<!-- Custom CSS -->

<link rel="stylesheet" href="/css/main.css">


<!-- Custom Fonts -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.0/css/all.min.css" />
<link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.0/css/all.min.css" />
<link href="//fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
<link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Gallery -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/featherlight@1.4.0/src/featherlight.css" integrity="sha256-30DV/STftlyQ6v8yaOWlabammvCYtRJERLj/m0b3zno=" crossorigin="anonymous">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/lightgallery@1.6.11/dist/css/lightgallery.min.css">

<!-- favicon -->

<link rel="icon" href="/img/logo-white.png"/>



    <!-- Google Analytics -->
    


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>
<!-- Head tag -->

<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top bg-transparent position-absolute w-100 p-0" id="nav">
    <div class="container pl-0 pr-0">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <a class="navbar-brand text-white p-1 pl-3" href="/">light655</a>
        </div>
        <div class="navbar-nav float-right">
            <button class="btn btn-link search-btn navbar-item" data-toggle="modal" data-target="#searchModal">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/img/home-bg-new.webp')">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 text-center">
                <div class="post-heading text-white">
                    <h1>TMAG5170 3D Hall-effect sensor</h1>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Main Content -->
            <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
                
                    <span class="meta d-inline-block">
    
    
    <!-- Date -->
    
        <span class="post-meta-split">&nbsp;|&nbsp;</span>
        <i class="far fa-calendar-check fa-fw"></i>
        2024-11-20
    
    <!-- word count and read count -->
    

    

</span>  
                
                <p>TMAG5170 is a 3-axis precision Hall effect sensor designed by Texas Instruments. On top of the Hall effect sensor, there is a temperature sensor and angle calculator intergrated in the IC. The functions of the IC can be interfaced with SPI. There are two variant of this IC, A1 and A2, the two variants differ in measuring range.</p>
<p><div class="img-item" data-src="/image/TMAG5170-pinout.png" data-sub-html=".caption"><img src="/image/TMAG5170-pinout.png" alt="(Source: Texas Instruments)"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">(Source: Texas Instruments)</span></div></div></p>
<span id="more"></span>

<h2 id="Pinout"><a href="#Pinout" class="headerlink" title="Pinout"></a>Pinout</h2><p>TMAG5170 uses the standard 4-wire SPI. The clock rate on the SCK line can be up to 10 MHz. </p>
<p>The nALERT pin can be used as a trigger to start the conversion or as notification to signal the microcontroller to read the conversion result.<br>A pull-up resistor should be connected to the nALERT pin, as it is an open-drain output.</p>
<p>The TEST pin should be grounded during normal operation.</p>
<p>A bypass capacitor must be placed between VCC and GND, or the high current demand during conversion may cause the device to  brown out.</p>
<h2 id="SPI-communication"><a href="#SPI-communication" class="headerlink" title="SPI communication"></a>SPI communication</h2><p>TMAG5170 uses a 32-bit SPI data frame. The first 28 bits are the data bits and the last 4 bits are CRC bits. TMAG5170 uses the polynomial $x^4 + x + 1$ and initial bits 0xff for CRC, see datasheet for more information.</p>
<h3 id="SDI-frame"><a href="#SDI-frame" class="headerlink" title="SDI frame"></a>SDI frame</h3><p>The SDI frame is the 32-bit data frame sent from the microcontroller to the TMAG5170. The definition of the data bits are as follow:<br><div class="img-item" data-src="/image/TMAG5170-SDI.png" data-sub-html=".caption"><img src="/image/TMAG5170-SDI.png" alt="(Source: Texas Instruments)"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">(Source: Texas Instruments)</span></div></div></p>
<p>The most significant bit determines whethere the command is a write(0) or read(1). The rest of the most significant byte is the address of the register to read from or write to. The middle 2 bytes are the data bits to write into the register. The upper nibble of the last byte is the command bits, which can be used to start a new conversion after the nCS line goes high.</p>
<h3 id="SDO-frame"><a href="#SDO-frame" class="headerlink" title="SDO frame"></a>SDO frame</h3><p>The SDO frame is the 32-bit data frame sent from the TMAG5170 back to the microcontroller. It contains 12 status bits and 16 data bits. The arrangement is shown in the following diagram.<br><div class="img-item" data-src="/image/TMAG5170-SDO.png" data-sub-html=".caption"><img src="/image/TMAG5170-SDO.png" alt="(Source: Texas Instruments)"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">(Source: Texas Instruments)</span></div></div></p>
<h3 id="CRC"><a href="#CRC" class="headerlink" title="CRC"></a>CRC</h3><p>CRC is used for error checking. If the TMAG5170 detects a CRC error in the SDI frame, it will invert the last bit of the SDO frame, making its CRC incorrect, to signal the microcontroller. TMAG5170 will not respond to register write commands if its CRC is incorrect. Also, the most significant bit of the SDO frame will go high if there is a CRC error in the previous frame.</p>
<p>CRC can be generated with linear shift registers. With our polynomial $x^4+x+1$, XOR gates will be connected to the shift registers as shown in the following figure:<br><img src="/image/TMAG5170-CRC.png"></p>
<p>The 4 register will be initalised with the inital value 0b1111 and the 28 data bits will first be appended with 0’s to 32 bits. After we shift all 32 bits into the shift register, the value in the 4 registers will be the CRC.<br>The following listing shows the shift register implementation for CRC generation. The CRC can also be generated with 4 XOR functions shown in the datasheet.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint32_t</span> <span class="title function_">generateCRC</span><span class="params">(<span class="type">uint32_t</span> data)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> CRC = <span class="number">0xf</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> inv = ((data &amp; <span class="number">0x80000000</span>) &gt;&gt; <span class="number">31</span>) ^ ((CRC &amp; <span class="number">0x8</span>) &gt;&gt; <span class="number">3</span>);</span><br><span class="line">        <span class="type">uint32_t</span> poly = (inv &lt;&lt; <span class="number">1</span>) | inv;</span><br><span class="line">        <span class="type">uint32_t</span> XORed = (CRC &lt;&lt; <span class="number">1</span>) ^ poly;</span><br><span class="line">        CRC = XORed &amp; <span class="number">0xf</span>;</span><br><span class="line">        data &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> CRC;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that the <em>data</em> variable contains the data bits and is already padded with 0’s.</p>
<h2 id="Magnetic-field-conversion"><a href="#Magnetic-field-conversion" class="headerlink" title="Magnetic field conversion"></a>Magnetic field conversion</h2><p>Although there are 3 Hall-effect sensors on the TMAG5170, there is only 1 ADC. Thus, the conversion of the magnetic field on the 3 axes are done in a round robin fashion.<br>Note that by “conversion” I mean the measurement of magnetic field. This terminology is used to stay consistent the datasheet.<br><div class="img-item" data-src="/image/TMAG5170-measure-timing.png" data-sub-html=".caption"><img src="/image/TMAG5170-measure-timing.png" alt="(Source: Texas Instruments)"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">(Source: Texas Instruments)</span></div></div></p>
<p>As shown in the figure, the measurements for the individual axes aren’t performed simultaneously. This is called pseudo-simultaneous sampling.<br>Pseudo-simultaneous sampling isn’t a big issue when a lower sampling rate is used. As the difference in time between axes isn’t significant compared to the sampling period. However, when the device is operated close to the maximum sampling rate, the effect of pseudo-simultaneous sampling should be considered.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.ti.com/product/TMAG5170">TMAG5170 product page</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ti.com/lit/ds/symlink/tmag5170.pdf?ts=1724125214091&ref_url=https%253A%252F%252Fwww.ti.com%252Fproduct%252FTMAG5170%253Fbm-verify%253DAAQAAAAJ_____7Z0pZQdTxprwY7q9QZLeEstv2APpOYoWXXneSlHeCBQSkEbCyUFRZChk9d05uy1l-YgoF2cbyq8XYduL0vlFzm1oIDc65JQiD3tk9WwlRxhAqd4zDIzbiooeDeyGelaFU3fqRx-0AcTmTflo_9_jT0MY3ZFV9rn4fPblXQ5WrUyB7Hz3cSRlL4ikW42FQtTw5qyFHOmy2XRu-rasuKoqnehHJYE1TMfl8D-gR_V8SJvkobQ2tUTS2N1K1o95Vgcy-FrVyRws0Xea4bYZo9-mwaUjYcPoElnuy3-13AGMRRw35XT">TMAG5170 datasheet</a></li>
</ul>

            </div>

            <!-- Post information -->
            
            
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
        <ul class="pagination d-block text-center">
            
                <li class="previous page-item d-inline"><a href="/2025/01/05/kicad-spice/" class="page-link float-left">&larr;  Newer</a></li>
            
            
        </ul>
    </div>


            
                <!-- Comments -->
                

                

            

        </div>
    </div>
</article> 


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    <style>
        #toc-content .toc-link::before {
            background-color: transparent;
            max-height: 25px;
        }

        #toc-content .toc-link.is-active-link::before {
            background-color: #404040;
        }
    </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <div class="ui-toc dropup scrollspy-body pull-right" style="right: 3%;">
        <button type="button" class="toc-btn btn btn-light" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static">
            <i class="fas fa-list"></i>
        </button>
        <div class="dropdown-menu dropdown-menu-right p-2"  aria-labelledby="tocLabel">
            <div class="toc-widget">
                <div id="toc-content" class="text-truncate">
                </div>
            </div>
            <div class="toc-menu pt-3 pl-4">
                <a class="expand-toggle d-block py-1" href="#"><span class="expand-text">Expand all</span><span class="close-text" style="display: none;">Collapse all</span></a>
                <a class="back-to-top d-block py-1" href="#">Back to top</a>
                <a class="go-to-bottom d-block py-1" href="#">Go to bottom</a>
            </div>
        </div>
    </div>
    <script>
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: '#toc-content',
            // Where to grab the headings to build the table of contents.
            contentSelector: 'article',
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h1, h2, h3',
            // For headings inside relative or absolute positioned containers within content.
            hasInnerContainers: true,
        });
    </script>


    <script src="//cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script>
        MathJax.Hub.Config({
            tex2jax:{inlineMath:[['$', '$']]}
        })
    </script>

    


    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer id="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 text-center">
                <ul class="list-inline">
                    

                    

                    

                    

                    

                    
                </ul>
                <ul class="copyright footer-menu list-inline">
                    
                    
                        <li class="list-inline-item">
                            
                            
                            <a href="/">
                                
                                    Home
                                
                            </a>
                        </li>
                    
                        <li class="list-inline-item">
                            
                                <span class="copyright-split">&nbsp;|&nbsp;</span>
                            
                            
                            <a href="/about">
                                
                                    About
                                
                            </a>
                        </li>
                    
                </ul>
                <p class="copyright footer-author">
                    &copy; -2025 
                    <a rel="external" class="copyright-link" href="" target="_blank">Chen, Liang-Yu</a><br/>
                    Powered by <a rel="external" class="copyright-link" href="https://hexo.io/" target="_blank">Hexo</a>  
                    <span class="copyright-split">&nbsp;|&nbsp;&nbsp;</span>
                    Theme <a rel="external" class="copyright-link" href="https://github.com/luswdev/hexo-theme-clean.git" target="_blank">Clean</a>
                    
                    
                </p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    <!-- jQuery -->
<script src="//cdn.jsdelivr.net/npm/jquery@2.1.4/dist/jquery.min.js"></script>

<!-- For drop down -->
<script src="//cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>

<!-- Bootstrap -->
<script src="//cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"></script>
<!-- Gallery -->
<script src="//cdn.jsdelivr.net/npm/lightgallery@1.6.11/dist/js/lightgallery-all.min.js"></script>

<!-- Search script -->

<script src="/js/search.js"></script>

<script type="text/javascript">
    $(function () {
        searchFunc( '/search.xml' , 'searchInput', 'searchResult');
    });
</script>



<script src="/js/main.js"></script>



    <!-- Search Modal -->
    <!-- Modal -->
<div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content overflow-auto">
            <div class="modal-header">
                <input type="text" class="form-control" placeholder="Searching Keywords..." id="searchInput">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="searchResult">
                    <div class="search-empty text-center text-muted p-5">
                        <i class="far fa-meh"></i>
                    </div>
                </div>
            </div> 
        </div>
    </div>
</div>


</body>
</html>