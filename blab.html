<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
  <meta charset="UTF-8" />
  <title>Blab | light655</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="/static/m-dark.css" />
  <link rel="canonical" href="/" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#cb4b16" />
  <meta property="og:site_name" content="light655" />
  <meta property="og:title" content="Blab" />
  <meta name="twitter:title" content="Blab" />
  <meta property="og:url" content="/" />
  <meta property="og:description" content="This is the place where I document things worth writing down but not long enough to make a blog post. (2026/01/14) When I was converting my website into the new format, I found that the test I conducted on the 74HC595 was flawed. There are two problems with …" />
  <meta name="twitter:description" content="This is the place where I document things worth writing down but not long enough to make a blog post. (2026/01/14) When I was converting my website into the new format, I found that the test I conducted on the 74HC595 was flawed. There are two problems with …" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:type" content="page" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="/" id="m-navbar-brand" class="m-col-t-9 m-col-m-none m-left-m">light655</a>
      <a id="m-navbar-show" href="#navigation" title="Show navigation" class="m-col-t-3 m-hide-m m-text-right"></a>
      <a id="m-navbar-hide" href="#" title="Hide navigation" class="m-col-t-3 m-hide-m m-text-right"></a>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="/blab.html" id="m-navbar-current">Blab</a></li>
            <li><a href="/Blog/">Blog</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/Product/">Product</a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main>
<article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>Blab</h1>
<!-- content -->
<p>This is the place where I document things worth writing down but not long enough to make a blog post.</p>
<hr />
<section id="section-1">
<h2>(2026/01/14)</h2>
<p>When I was converting my website into the new format, I found that the test I conducted on the 74HC595 was flawed.
There are two problems with that test.</p>
<p>The first is that I only loaded one of the output of the 74HC595.
Since this IC is typically used to drive a parallel bus of LEDs, I think that I should load all 8 outputs instead.</p>
<p>The second is that the Kelvin connection for measuring current was incorrect.
The goal of Kelvin connection is to <em>only measure the voltage across the resistor</em>.
When the larger current during measurement flows through the lead (drawn in red) resistance and breadboard contact resistance,
a voltage will develop and the voltage at the lower end of the resistor will be slightly higher than 0V.
By connecting probe (or amplifier in this case) in parallel to the resistor by the soldered second lead of the resistor (drawn in green), we can remove this voltage error from the measurement.</p>
<p><em>So, what went wrong?</em>
I shouldn't connect the crossed out black wire from the probe point to ground,
because it will introduce current flow through this black wire and thus the second lead of the resistor will carry a larger portion of current.
This means that the Kelvin connection I made is basically useless.
However, with the 10Ω resistance during testing, Kelvin connection is probably overkill in the first place.
Therefore, the test result is still pretty accurate (<em>as long as you are only using one of the output</em>).</p>
<img class="m-image" src="/data/74hc595-testing/74hc595-testing-breadboard-annotated.jpg" />
<p>I am planning on doing a test with all 8 outputs loaded, stay tuned!</p>
</section>
<hr />
<section id="section-2">
<h2>(2026/01/21)</h2>
<p>I was working on the arduino-TMAG5170 library and a nasty bug took me half a day to spot.
I typically develop new features on the pico-TMAG5170 with Raspberry Pi Pico SDK, since I am more familiar with that.
Then, I port the new code into the Arduino library and test them.</p>
<p>Today, I was porting the continuous measurement example.
I found that the very similar code running on the Arduino Uno is much slower than on the Pi Pico.
I know that there is large performance difference between the two microcontrollers, but that code was running way slower than anticipated.</p>
<p>It turned out that the <code class="m-code"><span class="n">attachSPI</span><span class="p">()</span></code> function had a bug inside that I didn't spot when I first ported the library.
The bug was: the parameter <code class="m-code"><span class="n">buadrate</span></code> was an &quot;int&quot;.
Why was this a bug?
Because the C standard only specified the &quot;int&quot; to be at least 16 bits wide.
Although most devices (including the Pico) have 32-bit &quot;int&quot; nowadays, the Arduino Uno has 16-bit &quot;int&quot;.
Therefore, I was expecting the <code class="m-code"><span class="n">buadrate</span></code> parameter to hold a 32-bit value but it wasn't.
In the example, I set the SPI baudrate to 1MHz, which can be fitted into a 32-bit &quot;int&quot; but not a 16-bit &quot;int&quot;.
The most significant 16 bits are truncated, leaving the final value of 16960 Hz.
This explains why the code was running much slower than I expected.</p>
<p>To solve this issue, I changed the type into &quot;uint32_t&quot;.
By explicitly setting the bit width, the aforementioned problem won't occur.
The taken away is, we use types that explicitly set the bit width in an Arduino library to maintain compatibility with different series of microcontrollers.</p>
</section>
<!-- /content -->
      </div>
    </div>
  </div>
</article>
</main>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>light655. Powered by <a href="https://getpelican.com">Pelican</a> and <a href="https://mcss.mosra.cz">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>